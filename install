<?php

use PhpMx\TerminalInstall;

return new class extends TerminalInstall {

    function __invoke()
    {
        self::createDir('class');
        self::createDir('class/Controller');
        self::createDir('library');
        self::createDir('library/assets');
        self::createDir('library/download');
        self::createDir('system');
        self::createDir('system/helper');
        self::createDir('system/helper/function');
        self::createDir('system/helper/constant');
        self::createDir('system/helper/script');
        self::createDir('system/middleware');
        self::createDir('system/router');
        self::createDir('system/view');

        self::promote('system/helper/script/path.php');

        self::promote('.htaccess');
        self::promote('index.php');

        self::blockFile('.env', 'MX CORE', [
            'DEV = true',
            'FORCE_SSL = false'
        ]);

        self::blockFile('.gitignore', 'MX CORE', [
            '/.env',
            '/vendor',
            '/library/cache',
            '/library/certificate',
            '/class/Model/Db*/Driver',
            '/library/sqlite',
            '/system/datalayer/*/scheme',
        ]);

        self::createFile('.conf', [
            '# PUBLIC ENVIRONMENT VARIABLES'
        ]);

        self::createFile('mx', [
            '<?php',
            '',
            'chdir(__DIR__);',
            '',
            'require_once "./vendor/autoload.php";',
            '',
            'echo "---< MX-CMD >---\n\n";',
            '',
            '$terminalArgs = $argv;',
            'array_shift($terminalArgs);',
            '\PhpMx\Terminal::run(...$terminalArgs);',
            '',
            'echo "\n---< MX-CMD >---\n";',
            '',
            'die;',
        ]);
    }
};
